<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สมาชิก - Order History</title>
    <link rel="stylesheet" href="./css/membership.css">
    <script defer>
        document.addEventListener("DOMContentLoaded", () => {
            fetch('/getUserData')
                .then(response => response.json())
                .then(data => {
                    if (data.username) {
                        document.querySelector('.username').textContent = `คุณ ${data.username}`;

                        // ดึงประวัติการสั่งซื้อจาก server
                        fetch(`/getOrderHistory/${data.username}`)
                            .then(response => response.json())
                            .then(orders => {
                                const orderSection = document.querySelector('.order-section');
                                if (orders.length > 0) {
                                    orders.forEach((order, index) => {
                                        if (index < 3) { // แสดงแค่ 3 รายการล่าสุด
                                            const orderDiv = document.createElement('div');
                                            orderDiv.classList.add('order-item');
                                            orderDiv.textContent = `${order.tableID} - ${order.totalPrice} Bath`;
                                            orderSection.appendChild(orderDiv);
                                        }
                                    });
                                }
                            })
                            .catch(error => {
                                console.error("Error fetching order history:", error);
                            });
                    }
                })
                .catch(error => {
                    console.error("Error fetching user data:", error);
                });
        });
    </script>
</head>
<body>

    <!-- Top Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-brand">สมาชิก</div>
        <div class="navbar-menu">
            <span class="menu-icon">&#9776;</span>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- User Profile Section -->
        <div class="profile">
            <div class="avatar">
                <img src="pic/snowman.png" alt="User Icon">
            </div>
            <div class="username">คุณ AAA</div>
        </div>

        <!-- Order History Section -->
        <div class="order-section">
            <div class="order-history">
                <!-- Order history will be dynamically inserted here -->
            </div>
        </div>

        <!-- Reserve Button -->
        <a href="reserve-table.html" class="reserve-button" id="reserve-button">จองโต๊ะ</a>

    </div>

    <section class="go-back">
        <a href="index.html">
            <button class="go-back-btn">กลับสู่หน้าหลัก</button>
        </a>
    </section>

</body>
</html>
